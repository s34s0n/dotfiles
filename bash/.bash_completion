_sagecomp()
{
   local cur files
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    files="$(compgen -o dirnames -X '!*.@(sage|?(s)pyx|py)' -f ${cur})"
    if [[ "$files" ]]
    then
      COMPREPLY=($(egrep -L '^# This file was \*autogenerated\* from the file .*\.sage' $files))
    fi
}
complete -F _sagecomp sage
